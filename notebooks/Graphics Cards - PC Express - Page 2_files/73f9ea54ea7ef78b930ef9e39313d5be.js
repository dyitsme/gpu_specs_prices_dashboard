"use strict";class Husky{constructor(t,e={}){this.searched_value="",this.current_page=0,this.data=Object.assign({},e),this.input=t,this.init_input(),this.container=document.createElement("div"),this.container.className="woof_husky_txt",this.input.insertAdjacentElement("afterend",this.container),this.fetch_timer=null,this.fetch_controller=null,document.addEventListener("click",t=>{t.target!==this.input&&this._show(!1)})}init_input(){Object.keys(this.data).forEach(t=>{this.input.hasAttribute(`data-${t}`)&&(this.data[t]=this.input.getAttribute(`data-${t}`))}),this.input.value=this.data.s,this.input.classList.contains("woof_husky_txt-input")||this.input.classList.add("woof_husky_txt-input"),this.input.setAttribute("autocomplete","off");let i=this;this.input.closest("div").querySelector(".woof_text_search_go")&&this.input.closest("div").querySelector(".woof_text_search_go").addEventListener("click",function(t){t.stopPropagation(),t.preventDefault();var t=i.input.value;return woof_current_values.woof_text=t,woof_ajax_page_num=1,woof_submit_link(woof_get_submit_link(),0),!1}),this.input.closest("form[role=search]")&&this.input.closest("form[role=search]").addEventListener("submit",function(t){t.stopPropagation(),t.preventDefault();var e=i.input.value,t=(i.data.min_symbols,i.data.min_symbols);return e.length>=t&&(woof_current_values.woof_text=e,woof_ajax_page_num=1,woof_submit_link(woof_get_submit_link(),0)),!1}),this.input.addEventListener("keyup",function(t){return t.stopPropagation(),t.preventDefault(),i.searched_value=this.value,i._search(1,t.key),!1}),this.input.addEventListener("focus",t=>{this._get_options_container()&&(this._get_options_container().style.display="block")})}_search(n=1,t=null){let o=this,s=this.searched_value,a=(this.data.min_symbols,this.data.min_symbols);if(this._loader(!1),this.fetch_timer&&clearTimeout(this.fetch_timer),0===s.length&&this._cross(!1),s.length>=a?jQuery(".woof_text_search_go").show(222):jQuery(".woof_text_search_go").hide(),woof_current_values.woof_text=s,"Enter"===t)return this._loader(),woof_ajax_page_num=1,woof_submit_link(woof_get_submit_link(),0),this._loader(!1),!0;if(0==parseInt(o.data.autocomplete))return!1;this.searched_value===s&&this.current_page,this.current_page=n;let e="Enter"!==t&&"Paged"!==t?777:1;return this.fetch_timer=setTimeout(()=>{let t=!0;var e,i,e;s.length<a&&(t=!1,this._reset()),this._loader(),t?(e=!1,0<Object.keys(woof_really_curr_tax).length&&(e=woof_really_curr_tax.term_id+"-"+woof_really_curr_tax.taxonomy),i={action:"woof_text_search",value:s,link:woof_get_submit_link(),cur_tax:e,page:n-1,...this.data},this._cross(),this.fetch_controller&&this.fetch_controller.abort(),this.fetch_controller=new AbortController,e=this.fetch_controller.signal,fetch(woof_husky_txt.ajax_url,{method:"POST",credentials:"same-origin",body:function(e){const i=new FormData;return Object.keys(e).forEach(function(t){i.append(t,e[t])}),i}(i),signal:e}).then(t=>t.json()).then(t=>{this._reset(),this.searched_value=s,this._loader(!1);let a=document.createElement("div");if(this.answer=a,this.answer.className="woof_husky_txt-container",this.container.appendChild(a),0<t.options.length)t.options.forEach(function(t){let e=document.createElement("div");e.className="woof_husky_txt-option",e.innerHTML=t;let i=e.querySelector(".woof_husky_txt-option-title"),n=i.querySelector("a");var t;parseInt(o.data.title_light)&&(t=new RegExp("("+s+")","ig"),n.innerHTML=i.innerText.replace(t,"<span class='woof_husky_txt-highlight'>$1</span>")),a.appendChild(e)}),1<t.pagination.pages&&this._draw_pagination(a,t);else{let t=document.createElement("div");t.className="woof_husky_txt-option";let e=document.createElement("div"),i=document.createElement("div");i.className="woof_husky_txt-option-title",i.textContent=woof_husky_txt.not_found,e.appendChild(i),t.appendChild(e),a.appendChild(t)}this._show()}).catch(t=>{console.log(t)})):this._loader(!1)},e),!0}_show(t=!0){if(t){let t=1,i=this._get_options_container(),n=setInterval(()=>{let e=0;void 0!==this.data.max_open_height?e=parseInt(this.data.max_open_height):i.querySelectorAll(".woof_husky_txt-option").forEach(function(t){e+=t.offsetHeight}),i.style.maxHeight=parseFloat(.05*t)*e+"px",parseInt(i.style.maxHeight)>=e&&(clearInterval(n),void 0!==this.data.max_open_height?(i.style.maxHeight=e+"px",i.style.overflow="auto"):i.style.maxHeight="100vh"),t++},10)}else if(this._get_options_container()){let t=this._get_options_container();t.style.display="none",t.style.overflow}}_loader(t=!0){t?(this.loader=document.createElement("div"),this.loader.className="woof_husky_txt-loader",this.loader.style.width=this.loader.style.height=this.input.offsetHeight+"px",this.loader.style.top="-"+(this.input.offsetHeight-1)+"px",this.container.appendChild(this.loader)):this.loader&&this.loader.remove()}_cross(t=!0){if(!this.cross){this.cross=document.createElement("span"),this.cross.className="woof_husky_txt-cross",this.cross.innerText="x",this.cross.style.width=this.cross.style.height=this.input.offsetHeight/2+"px",this.cross.style.top="-"+this.input.offsetHeight/2+"px",this.cross.style.right="-23px",this.container.appendChild(this.cross);let e=this;this.cross.addEventListener("click",function(t){return t.stopPropagation(),e.input.value="",e._cross(!1),e.answer&&e.answer.remove(),e.fetch_controller&&e.fetch_controller.abort(),e.fetch_timer&&clearTimeout(e.fetch_timer),!0})}this.cross.style.display=t?"inline":"none"}_reset(){this._get_options_container()&&this._get_options_container().remove()}_get_options_container(){return this.container.querySelector(".woof_husky_txt-container")}_draw_pagination(t,e){let i=this,n=document.createElement("div");n.className="woof_husky_txt-option woof_husky_txt-option-pagination";let a=document.createElement("div");a.className="husky-pagination",n.appendChild(a),t.appendChild(n);let o=null;for(let t=1;t<=e.pagination.pages;t++)12<e.pagination.pages&&1!==t&&t!==e.pagination.pages?(t!==e.pagination.page&&t!==e.pagination.page-1&&t!==e.pagination.page-2&&t!==e.pagination.page-3&&t!==e.pagination.page+1&&t!==e.pagination.page+2&&t!==e.pagination.page+3||this._draw_pagination_btn(e.pagination.page,t,a),t!==e.pagination.page-4&&t!==e.pagination.page+4||(o=document.createElement("i"),o.innerText=" ... ",a.appendChild(o))):this._draw_pagination_btn(e.pagination.page,t,a);1<e.pagination.page&&(o=document.createElement("a"),o.href="#",o.innerText=woof_husky_txt.prev,o.addEventListener("click",function(t){return t.preventDefault(),t.stopPropagation(),i._search(e.pagination.page-1,"Paged"),!1}),a.prepend(o)),e.pagination.page<e.pagination.pages&&(o=document.createElement("a"),o.href="#",o.innerText=woof_husky_txt.next,o.addEventListener("click",function(t){return t.preventDefault(),t.stopPropagation(),i._search(e.pagination.page+1,"Paged"),!1}),a.appendChild(o))}_draw_pagination_btn(t,e,i){let n=null,a=this;parseInt(t)===e?(n=document.createElement("b"),n.innerText=e):(n=document.createElement("a"),n.href="#",n.innerText=n.dataset.page=e,n.addEventListener("click",function(t){return t.preventDefault(),t.stopPropagation(),a._search(this.dataset.page,"Paged"),!1})),i.appendChild(n)}}