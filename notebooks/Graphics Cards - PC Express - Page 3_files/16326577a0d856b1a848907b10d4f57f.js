var gtm4wp_last_selected_product_variation,gtm4wp_changedetail_fired_during_pageload=!1;function gtm4wp_map_eec_to_ga4(t){if(t){var e,a=(t.category||"").toString().split("/"),c={item_id:t.id||"",item_name:t.name||"",item_brand:t.brand||"",price:t.price||""};if(1==a.length)c.item_category=a[0];else if(1<a.length){c.item_category=a[0];for(var r=1;r<Math.min(5,a.length);r++)c["item_category_"+(r+1)]=a[r]}return t.variant&&(c.item_variant=t.variant),t.list&&(c.item_list_name=t.list),t.position&&(c.index=t.position),t.quantity&&(c.quantity=t.quantity),t.coupon&&(c.coupon=t.coupon),c.google_business_vertical=window.gtm4wp_business_vertical,c[window.gtm4wp_business_vertical_id]=gtm4wp_id_prefix+c.item_id,c}}function gtm4wp_handle_cart_qty_change(){jQuery(".product-quantity input.qty").each(function(){var t=jQuery(this).prop("defaultValue"),e=parseInt(jQuery(this).val()),a,c,r,r;t!=(e=Number.isNaN(e)?t:e)&&("string"==typeof(c=(a=jQuery(this).closest(".cart_item").find(".remove")).data("gtm4wp_product_price"))?(c=parseFloat(c),isNaN(c)&&(c=0)):"number"!=typeof c&&(c=0),t<e?(r={name:a.data("gtm4wp_product_name"),id:a.data("gtm4wp_product_id"),price:c.toFixed(2),category:a.data("gtm4wp_product_cat"),variant:a.data("gtm4wp_product_variant"),stocklevel:a.data("gtm4wp_product_stocklevel"),brand:a.data("gtm4wp_product_brand"),quantity:e-t},window[gtm4wp_datalayer_name].push({event:"gtm4wp.addProductToCartEEC",ecommerce:{currencyCode:gtm4wp_currency,add:{products:[r]}}}),window[gtm4wp_datalayer_name].push({event:"add_to_cart",ecommerce:{currency:gtm4wp_currency,value:c.toFixed(2)*(e-t),items:[gtm4wp_map_eec_to_ga4(r)]}})):(r={name:a.data("gtm4wp_product_name"),id:a.data("gtm4wp_product_id"),price:c.toFixed(2),category:a.data("gtm4wp_product_cat"),variant:a.data("gtm4wp_product_variant"),stocklevel:a.data("gtm4wp_product_stocklevel"),brand:a.data("gtm4wp_product_brand"),quantity:t-e},window[gtm4wp_datalayer_name].push({event:"gtm4wp.removeFromCartEEC",ecommerce:{currencyCode:gtm4wp_currency,remove:{products:[r]}}}),window[gtm4wp_datalayer_name].push({event:"remove_from_cart",ecommerce:{currency:gtm4wp_currency,value:c.toFixed(2)*(t-e),items:[gtm4wp_map_eec_to_ga4(r)]}})))})}jQuery(function(){var is_cart=jQuery("body").hasClass("woocommerce-cart"),is_checkout=jQuery("body").hasClass("woocommerce-checkout"),gtm4wp_shipping_payment_method_step_offset,gtm4wp_checkout_step_fired;if(0<jQuery(".gtm4wp_productdata,.widget-product-item").length){var products=[],ga4_products=[],productdata,productprice=0,product_data,chunk,ga4_chunk;if(jQuery(".gtm4wp_productdata,.widget-product-item").each(function(){productdata=jQuery(this),"string"==typeof(productprice=productdata.data("gtm4wp_product_price"))?(productprice=parseFloat(productprice),isNaN(productprice)&&(productprice=0)):"number"!=typeof productprice&&(productprice=0),product_data={name:productdata.data("gtm4wp_product_name"),id:productdata.data("gtm4wp_product_id"),price:productprice.toFixed(2),category:productdata.data("gtm4wp_product_cat"),position:productdata.data("gtm4wp_product_listposition"),list:productdata.data("gtm4wp_productlist_name"),stocklevel:productdata.data("gtm4wp_product_stocklevel"),brand:productdata.data("gtm4wp_product_brand")},products.push(product_data),ga4_products.push(gtm4wp_map_eec_to_ga4(product_data))}),0<gtm4wp_product_per_impression)for(;products.length;)chunk=products.splice(0,gtm4wp_product_per_impression),ga4_chunk=ga4_products.splice(0,gtm4wp_product_per_impression),window[gtm4wp_datalayer_name].push({event:"gtm4wp.productImpressionEEC",ecommerce:{currencyCode:gtm4wp_currency,impressions:chunk}}),window[gtm4wp_datalayer_name].push({event:"view_item_list",ecommerce:{currency:gtm4wp_currency,items:ga4_chunk}});else{for(var i=0;i<window[gtm4wp_datalayer_name].length;i++)if(window[gtm4wp_datalayer_name][i].ecommerce){window[gtm4wp_datalayer_name][i].ecommerce.impressions?window[gtm4wp_datalayer_name][i].ecommerce.impressions=window[gtm4wp_datalayer_name][i].ecommerce.impressions.concat(products):window[gtm4wp_datalayer_name][i].ecommerce.impressions=products;break}i==window[gtm4wp_datalayer_name].length&&(i=0,window[gtm4wp_datalayer_name][i].ecommerce={},window[gtm4wp_datalayer_name][i].ecommerce.impressions=products),window[gtm4wp_datalayer_name][i].ecommerce.currencyCode=gtm4wp_currency}}if(jQuery(document).on("click",".add_to_cart_button:not(.product_type_variable, .product_type_grouped, .single_add_to_cart_button)",function(){var t=jQuery(this).closest(".product").find(".gtm4wp_productdata"),e=t.data("gtm4wp_product_price");"string"==typeof e?(e=parseFloat(e),isNaN(e)&&(e=0)):"number"!=typeof e&&(e=0);var t={name:t.data("gtm4wp_product_name"),id:t.data("gtm4wp_product_id"),price:e.toFixed(2),category:t.data("gtm4wp_product_cat"),stocklevel:t.data("gtm4wp_product_stocklevel"),brand:t.data("gtm4wp_product_brand"),quantity:1};window[gtm4wp_datalayer_name].push({event:"gtm4wp.addProductToCartEEC",ecommerce:{currencyCode:gtm4wp_currency,add:{products:[t]}}}),window[gtm4wp_datalayer_name].push({event:"add_to_cart",ecommerce:{currency:gtm4wp_currency,value:e.toFixed(2),items:[gtm4wp_map_eec_to_ga4(t)]}})}),jQuery(document).on("click",".single_add_to_cart_button:not(.disabled)",function(){var t=jQuery(this).closest("form.cart"),e=jQuery("[name=variation_id]",t),a=jQuery(t).hasClass("grouped_form"),a,c,r,o,t;0<e.length?gtm4wp_last_selected_product_variation&&(gtm4wp_last_selected_product_variation.quantity=jQuery("[name=quantity]",t).val(),window[gtm4wp_datalayer_name].push({event:"gtm4wp.addProductToCartEEC",ecommerce:{currencyCode:gtm4wp_currency,add:{products:[gtm4wp_last_selected_product_variation]}}}),window[gtm4wp_datalayer_name].push({event:"add_to_cart",ecommerce:{currency:gtm4wp_currency,value:gtm4wp_last_selected_product_variation.price*gtm4wp_last_selected_product_variation.quantity,items:[gtm4wp_map_eec_to_ga4(gtm4wp_last_selected_product_variation)]}})):a?(a=jQuery(".grouped_form .gtm4wp_productdata"),c=[],r=[],o=0,a.each(function(){var t=jQuery(this),e=jQuery("input[name=quantity\\["+t.data("gtm4wp_product_id")+"\\]]"),t;0<e.length&&(product_qty=e.val(),0!=product_qty&&(t={id:gtm4wp_use_sku_instead?t.data("gtm4wp_product_sku"):t.data("gtm4wp_product_id"),name:t.data("gtm4wp_product_name"),price:t.data("gtm4wp_product_price"),category:t.data("gtm4wp_product_cat"),quantity:product_qty,stocklevel:t.data("gtm4wp_product_stocklevel"),brand:t.data("gtm4wp_product_brand")},c.push(t),r.push(gtm4wp_map_eec_to_ga4(t)),o+=t.price*t.quantity))}),0!=c.length&&(window[gtm4wp_datalayer_name].push({event:"gtm4wp.addProductToCartEEC",ecommerce:{currencyCode:gtm4wp_currency,add:{products:c}}}),window[gtm4wp_datalayer_name].push({event:"add_to_cart",ecommerce:{currency:gtm4wp_currency,value:o,items:r}}))):(t={id:(gtm4wp_use_sku_instead?jQuery("[name=gtm4wp_sku]",t):jQuery("[name=gtm4wp_id]",t)).val(),name:jQuery("[name=gtm4wp_name]",t).val(),price:jQuery("[name=gtm4wp_price]",t).val(),category:jQuery("[name=gtm4wp_category]",t).val(),quantity:jQuery("[name=quantity]",t).val(),stocklevel:jQuery("[name=gtm4wp_stocklevel]",t).val(),brand:jQuery("[name=gtm4wp_brand]",t).val()},window[gtm4wp_datalayer_name].push({event:"gtm4wp.addProductToCartEEC",ecommerce:{currencyCode:gtm4wp_currency,add:{products:[t]}}}),window[gtm4wp_datalayer_name].push({event:"add_to_cart",ecommerce:{currency:gtm4wp_currency,value:t.price*t.quantity,items:[gtm4wp_map_eec_to_ga4(t)]}}))}),jQuery(document).on("click",".mini_cart_item a.remove,.product-remove a.remove",function(){var t=jQuery(this),e=0,a=jQuery(this).closest(".cart_item").find(".product-quantity input.qty");if(0===a.length?0<(a=jQuery(this).closest(".mini_cart_item").find(".quantity")).length&&(e=parseInt(a.text()),Number.isNaN(e)&&(e=0)):e=a.val(),0===e)return!0;var e={name:t.data("gtm4wp_product_name"),id:t.data("gtm4wp_product_id"),price:t.data("gtm4wp_product_price"),category:t.data("gtm4wp_product_cat"),variant:t.data("gtm4wp_product_variant"),stocklevel:t.data("gtm4wp_product_stocklevel"),brand:t.data("gtm4wp_product_brand"),quantity:e};window[gtm4wp_datalayer_name].push({event:"gtm4wp.removeFromCartEEC",ecommerce:{currencyCode:gtm4wp_currency,remove:{products:[e]}}}),window[gtm4wp_datalayer_name].push({event:"remove_from_cart",ecommerce:{currency:gtm4wp_currency,value:e.price*e.quantity,items:[gtm4wp_map_eec_to_ga4(e)]}})}),jQuery(document).on("click",".products li:not(.product-category) a:not(.add_to_cart_button):not(.quick-view-button),.products>div:not(.product-category) a:not(.add_to_cart_button):not(.quick-view-button),.widget-product-item,.woocommerce-grouped-product-list-item__label a",function(t){if("undefined"==typeof google_tag_manager)return!0;var e=jQuery(this).closest(".product"),a="",a;if(void 0===(a=0<e.length?e.find(".gtm4wp_productdata"):0<(e=jQuery(this).closest(".products li")).length?e.find(".gtm4wp_productdata"):0<(e=jQuery(this).closest(".products>div")).length?e.find(".gtm4wp_productdata"):0<(e=jQuery(this).closest(".woocommerce-grouped-product-list-item__label")).length?e.find(".gtm4wp_productdata"):jQuery(this)).data("gtm4wp_product_id")||""==a.data("gtm4wp_product_id"))return!0;if(a.data("gtm4wp_product_url")!=jQuery(this).attr("href"))return!0;var c=t.ctrlKey||t.metaKey,r;t.preventDefault(),c&&(r=window.open("about:blank","_blank"));var o={id:a.data("gtm4wp_product_id"),name:a.data("gtm4wp_product_name"),price:a.data("gtm4wp_product_price"),category:a.data("gtm4wp_product_cat"),stocklevel:a.data("gtm4wp_product_stocklevel"),brand:a.data("gtm4wp_product_brand"),position:a.data("gtm4wp_product_listposition")};window[gtm4wp_datalayer_name].push({event:"gtm4wp.productClickEEC",ecommerce:{currencyCode:gtm4wp_currency,click:{actionField:{list:a.data("gtm4wp_productlist_name")},products:[o]}},eventCallback:function(){window["gtm4wp_select_item_"+o.id]||(window[gtm4wp_datalayer_name].push({event:"select_item",ecommerce:{currency:gtm4wp_currency,items:[gtm4wp_map_eec_to_ga4(o)]},eventCallback:function(){c&&r?r.location.href=a.data("gtm4wp_product_url"):document.location.href=a.data("gtm4wp_product_url")},eventTimeout:2e3}),window["gtm4wp_select_item_"+o.id]=!0)},eventTimeout:2e3})}),jQuery(document).on("found_variation",function(t,e){if(void 0!==e&&("interactive"!==document.readyState||!gtm4wp_changedetail_fired_during_pageload)){var a=t.target,c=jQuery("[name=variation_id]",a),r=jQuery("[name=gtm4wp_id]",a).val(),o=jQuery("[name=gtm4wp_name]",a).val(),p=jQuery("[name=gtm4wp_sku]",a).val(),t=jQuery("[name=gtm4wp_category]",a).val(),m=jQuery("[name=gtm4wp_price]",a).val(),n,_,a={name:o,id:0,price:0,category:t,stocklevel:jQuery("[name=gtm4wp_stocklevel]",a).val(),brand:jQuery("[name=gtm4wp_brand]",a).val(),variant:""};a.id=e.variation_id,gtm4wp_use_sku_instead&&e.sku&&""!==e.sku&&(a.id=e.sku),a.price=e.display_price;var d=[],i;for(i in e.attributes)d.push(e.attributes[i]);a.variant=d.join(","),gtm4wp_last_selected_product_variation=a,window[gtm4wp_datalayer_name].push({event:"gtm4wp.changeDetailViewEEC",ecommerce:{currencyCode:gtm4wp_currency,detail:{products:[a]}},ecomm_prodid:gtm4wp_id_prefix+a.id,ecomm_pagetype:"product",ecomm_totalvalue:a.price}),window[gtm4wp_datalayer_name].push({event:"view_item",ecommerce:{currency:gtm4wp_currency,items:[gtm4wp_map_eec_to_ga4(a)]}}),"interactive"===document.readyState&&(gtm4wp_changedetail_fired_during_pageload=!0)}}),jQuery(".variations select").trigger("change"),jQuery(document).ajaxSuccess(function(event,xhr,settings){void 0!==settings&&-1<settings.url.indexOf("wc-api=WC_Quick_View")&&setTimeout(function(){jQuery(".woocommerce.quick-view").parent().find("script").each(function(i){eval(jQuery(this).text())})},500)}),is_cart&&(jQuery(document).on("click","[name=update_cart]",function(){gtm4wp_handle_cart_qty_change()}),jQuery(document).on("keypress",".woocommerce-cart-form input[type=number]",function(){gtm4wp_handle_cart_qty_change()})),is_checkout&&(window.gtm4wp_checkout_step_offset=window.gtm4wp_checkout_step_offset||0,window.gtm4wp_checkout_value=window.gtm4wp_checkout_value||0,window.gtm4wp_checkout_products=window.gtm4wp_checkout_products||[],window.gtm4wp_checkout_products_ga4=window.gtm4wp_checkout_products_ga4||[],gtm4wp_shipping_payment_method_step_offset=window.gtm4wp_needs_shipping_address?0:-1,gtm4wp_checkout_step_fired=[],jQuery(document).on("blur","input[name^=shipping_]:not(input[name^=shipping_method])",function(){-1<gtm4wp_checkout_step_fired.indexOf("shipping")||""!=jQuery(this).val().trim()&&(window[gtm4wp_datalayer_name].push({event:"gtm4wp.checkoutStepEEC",ecommerce:{currencyCode:gtm4wp_currency,checkout:{actionField:{step:2+window.gtm4wp_checkout_step_offset},products:window.gtm4wp_checkout_products}}}),gtm4wp_checkout_step_fired.push("shipping"))}),jQuery(document).on("change","input[name^=shipping_method]",function(){var t,e;-1<gtm4wp_checkout_step_fired.indexOf("shipping_method")||"complete"==document.readyState&&(t="(shipping tier not found)",0<(e=0==(e=jQuery("input[name^=shipping_method]:checked")).length?jQuery("input[name^=shipping_method]:first"):e).length&&(t=e.val()),window[gtm4wp_datalayer_name].push({event:"gtm4wp.checkoutStepEEC",ecommerce:{currencyCode:gtm4wp_currency,checkout:{actionField:{step:3+window.gtm4wp_checkout_step_offset+gtm4wp_shipping_payment_method_step_offset},products:window.gtm4wp_checkout_products}}}),window[gtm4wp_datalayer_name].push({event:"add_shipping_info",ecommerce:{currency:gtm4wp_currency,shipping_tier:t,value:window.gtm4wp_checkout_value,items:window.gtm4wp_checkout_products_ga4}}),gtm4wp_checkout_step_fired.push("shipping_method"))}),jQuery(document).on("change","input[name=payment_method]",function(){var t,e;-1<gtm4wp_checkout_step_fired.indexOf("payment_method")||"complete"==document.readyState&&(t="(payment type not found)",0<(e=0==(e=jQuery(".payment_methods input:checked")).length?jQuery("input[name^=payment_method]:first"):e).length&&(t=e.val()),window[gtm4wp_datalayer_name].push({event:"gtm4wp.checkoutStepEEC",ecommerce:{currencyCode:gtm4wp_currency,checkout:{actionField:{step:4+window.gtm4wp_checkout_step_offset+gtm4wp_shipping_payment_method_step_offset},products:window.gtm4wp_checkout_products}}}),window[gtm4wp_datalayer_name].push({event:"add_payment_info",ecommerce:{currency:gtm4wp_currency,payment_type:t,value:window.gtm4wp_checkout_value,items:window.gtm4wp_checkout_products_ga4}}),gtm4wp_checkout_step_fired.push("payment_method"))}),jQuery("form[name=checkout]").on("submit",function(){var t;-1!=gtm4wp_checkout_step_fired.indexOf("shipping_method")||0<(t=0==(t=jQuery("input[name^=shipping_method]:checked")).length?jQuery("input[name^=shipping_method]:first"):t).length&&t.trigger("change"),-1==gtm4wp_checkout_step_fired.indexOf("payment_method")&&jQuery("input[name=payment_method]:checked").trigger("change");var t=jQuery("input[name^=shipping_method]:checked");0<(t=0==t.length?jQuery("input[name^=shipping_method]:first"):t).length&&window[gtm4wp_datalayer_name].push({event:"gtm4wp.checkoutOptionEEC",ecommerce:{checkout_option:{actionField:{step:3+window.gtm4wp_checkout_step_offset+gtm4wp_shipping_payment_method_step_offset,option:"Shipping: "+t.val()}}}});var t=jQuery(".payment_methods input:checked");0<(t=0==t.length?jQuery("input[name^=payment_method]:first"):t).length&&window[gtm4wp_datalayer_name].push({event:"gtm4wp.checkoutOptionEEC",ecommerce:{checkout_option:{actionField:{step:4+window.gtm4wp_checkout_step_offset+gtm4wp_shipping_payment_method_step_offset,option:"Payment: "+t.val()}}}})})),window.gtm4wp_remarketing&&!is_cart&&!is_checkout&&0<jQuery(".gtm4wp_productdata").length){for(var i=0,productdata;i<window[gtm4wp_datalayer_name].length&&!window[gtm4wp_datalayer_name][i].ecomm_prodid;i++);i==window[gtm4wp_datalayer_name].length&&(i=0,window[gtm4wp_datalayer_name][i].ecomm_prodid=[]),void 0!==window[gtm4wp_datalayer_name][i].ecomm_prodid.push&&jQuery(".gtm4wp_productdata").each(function(){productdata=jQuery(this),window[gtm4wp_datalayer_name][i].ecomm_prodid.push(gtm4wp_id_prefix+productdata.data("gtm4wp_product_id"))})}window[gtm4wp_datalayer_name]&&window[gtm4wp_datalayer_name].forEach&&window[gtm4wp_datalayer_name].forEach(function(t){var e,a,c,a,c,a,c,a;t&&t.ecommerce&&t.ecommerce.detail&&window[gtm4wp_datalayer_name].push({event:"view_item",ecommerce:{currency:gtm4wp_currency,items:[gtm4wp_map_eec_to_ga4(t.ecommerce.detail.products[0])]}}),t&&t.ecommerce&&(t.ecommerce.cart||t.ecommerce.checkout&&is_cart)&&(e=t.ecommerce.cart||t.ecommerce.checkout.products,a=[],c=0,e.forEach(function(t){a.push(gtm4wp_map_eec_to_ga4(t)),c+=t.price*t.quantity}),window[gtm4wp_datalayer_name].push({event:"view_cart",ecommerce:{currency:gtm4wp_currency,value:c.toFixed(2),items:a}})),t&&t.ecommerce&&t.ecommerce.checkout&&!is_cart&&(a=[],c=0,t.ecommerce.checkout.products.forEach(function(t){a.push(gtm4wp_map_eec_to_ga4(t)),c+=t.price*t.quantity}),window[gtm4wp_datalayer_name].push({event:"begin_checkout",ecommerce:{currency:gtm4wp_currency,value:c,items:a}})),t&&t.ecommerce&&t.ecommerce.add&&(a=[],c=0,t.ecommerce.add.products.forEach(function(t){a.push(gtm4wp_map_eec_to_ga4(t)),c+=t.price*t.quantity}),window[gtm4wp_datalayer_name].push({event:"add_to_cart",ecommerce:{currency:gtm4wp_currency,value:c,items:a}})),t&&t.ecommerce&&t.ecommerce.purchase&&(a=[],t.ecommerce.purchase.products.forEach(function(t){a.push(gtm4wp_map_eec_to_ga4(t))}),window[gtm4wp_datalayer_name].push({event:"purchase",ecommerce:{currency:gtm4wp_currency,items:a,transaction_id:t.ecommerce.purchase.actionField.id,affiliation:t.ecommerce.purchase.actionField.affiliation,value:t.ecommerce.purchase.actionField.revenue,tax:t.ecommerce.purchase.actionField.tax,shipping:t.ecommerce.purchase.actionField.shipping,coupon:t.ecommerce.purchase.actionField.coupon}}))})});