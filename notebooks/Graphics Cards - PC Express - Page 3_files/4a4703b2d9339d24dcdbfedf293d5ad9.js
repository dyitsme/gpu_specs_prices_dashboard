!function(u){function s(i){this.init(i)}s.prototype={value:0,size:100,startAngle:-Math.PI,thickness:"auto",fill:{gradient:["#3aeabb","#fdd250"]},emptyFill:"rgba(0, 0, 0, .1)",animation:{duration:1200,easing:"circleProgressEasing"},animationStartValue:0,reverse:!1,lineCap:"butt",constructor:s,el:null,canvas:null,ctx:null,radius:0,arcFill:null,lastFrameValue:0,init:function(i){u.extend(this,i),this.radius=this.size/2,this.initWidget(),this.initFill(),this.draw()},initWidget:function(){var i=this.canvas=this.canvas||u("<canvas>").prependTo(this.el)[0];i.width=this.size,i.height=this.size,this.ctx=i.getContext("2d")},initFill:function(){var t=this,i=this.fill,a=this.ctx,e=this.size,n;if(!i)throw Error("The fill is not specified!");if(i.color&&(this.arcFill=i.color),i.gradient){var r=i.gradient;if(1==r.length)this.arcFill=r[0];else if(1<r.length){for(var s=i.gradientAngle||0,s=i.gradientDirection||[e/2*(1-Math.cos(s)),e/2*(1+Math.sin(s)),e/2*(1+Math.cos(s)),e/2*(1-Math.sin(s))],l=a.createLinearGradient.apply(a,s),h=0;h<r.length;h++){var o=r[h],c=h/(r.length-1);u.isArray(o)&&(c=o[1],o=o[0]),l.addColorStop(c,o)}this.arcFill=l}}function d(){var i=u("<canvas>")[0];i.width=t.size,i.height=t.size,i.getContext("2d").drawImage(n,0,0,e,e),t.arcFill=t.ctx.createPattern(i,"no-repeat"),t.drawFrame(t.lastFrameValue)}i.image&&(i.image instanceof Image?n=i.image:(n=new Image).src=i.image,n.complete?d():n.onload=d)},draw:function(){this.animation?this.drawAnimated(this.value):this.drawFrame(this.value)},drawFrame:function(i){this.lastFrameValue=i,this.ctx.clearRect(0,0,this.size,this.size),this.drawEmptyArc(i),this.drawArc(i)},drawArc:function(i){var t=this.ctx,a=this.radius,e=this.getThickness(),n=this.startAngle;t.save(),t.beginPath(),this.reverse?t.arc(a,a,a-e/2,n-2*Math.PI*i,n):t.arc(a,a,a-e/2,n,n+2*Math.PI*i),t.lineWidth=e,t.lineCap=this.lineCap,t.strokeStyle=this.arcFill,t.stroke(),t.restore()},drawEmptyArc:function(i){var t=this.ctx,a=this.radius,e=this.getThickness(),n=this.startAngle;i<1&&(t.save(),t.beginPath(),i<=0?t.arc(a,a,a-e/2,0,2*Math.PI):this.reverse?t.arc(a,a,a-e/2,n,n-2*Math.PI*i):t.arc(a,a,a-e/2,n+2*Math.PI*i,n),t.lineWidth=e,t.strokeStyle=this.emptyFill,t.stroke(),t.restore())},drawAnimated:function(a){var e=this,n=this.el,i=u(this.canvas);i.stop(!0,!1),n.trigger("circle-animation-start"),i.css({animationProgress:0}).animate({animationProgress:1},u.extend({},this.animation,{step:function(i){var t=e.animationStartValue*(1-i)+a*i;e.drawFrame(t),n.trigger("circle-animation-progress",[i,t])}})).promise().always(function(){n.trigger("circle-animation-end")})},getThickness:function(){return u.isNumeric(this.thickness)?this.thickness:this.size/14},getValue:function(){return this.value},setValue:function(i){this.animation&&(this.animationStartValue=this.lastFrameValue),this.value=i,this.draw()}},u.circleProgress={defaults:s.prototype},u.easing.circleProgressEasing=function(i,t,a,e,n){return(t/=n/2)<1?e/2*t*t*t+a:e/2*((t-=2)*t*t+2)+a},u.fn.circleProgress=function(n,i){var r="circle-progress",t=this.data(r);if("widget"==n){if(!t)throw Error('Calling "widget" method on not initialized instance is forbidden');return t.canvas}if("value"!=n)return this.each(function(){var i=u(this),t=i.data(r),a=u.isPlainObject(n)?n:{},e;t?t.init(a):("string"==typeof(e=u.extend({},i.data())).fill&&(e.fill=JSON.parse(e.fill)),"string"==typeof e.animation&&(e.animation=JSON.parse(e.animation)),(a=u.extend(e,a)).el=i,t=new s(a),i.data(r,t))});if(!t)throw Error('Calling "value" method on not initialized instance is forbidden');if(void 0===i)return t.getValue();var a=i;return this.each(function(){u(this).data(r).setValue(a)})}}(jQuery);